# Authentik Helm Values
# Documentation: https://docs.goauthentik.io/
# Secrets are pulled from Vault via External Secrets Operator

authentik:
  secret_key: ""  # Loaded from authentik-secrets via AUTHENTIK_SECRET_KEY env
  error_reporting:
    enabled: false
  postgresql:
    password: ""  # Loaded via AUTHENTIK_POSTGRESQL__PASSWORD env

server:
  replicas: 1
  ingress:
    enabled: false  # Using Traefik IngressRoute instead
  env:
    - name: AUTHENTIK_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: authentik-secrets
          key: secret-key
    - name: AUTHENTIK_POSTGRESQL__PASSWORD
      valueFrom:
        secretKeyRef:
          name: authentik-secrets
          key: postgres-password

worker:
  replicas: 1
  env:
    - name: AUTHENTIK_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: authentik-secrets
          key: secret-key
    - name: AUTHENTIK_POSTGRESQL__PASSWORD
      valueFrom:
        secretKeyRef:
          name: authentik-secrets
          key: postgres-password

postgresql:
  enabled: true
  auth:
    existingSecret: authentik-secrets
    secretKeys:
      userPasswordKey: postgres-password
  image:
    registry: docker.io
    repository: bitnami/postgresql
    tag: latest
  primary:
    persistence:
      storageClass: proxmox
      size: 8Gi

redis:
  enabled: true
  image:
    registry: docker.io
    repository: bitnami/redis
    tag: latest
  master:
    persistence:
      storageClass: proxmox
      size: 2Gi
